[BOOT] Environment=Production ConfigFiles=appsettings.json, appsettings.Production.json
[BOOT] OS=Debian GNU/Linux 13 (trixie) Arch=X64 Machine=ynz
[BOOT] Scoring=19 NumCurvesWeight=0.6 ExtraThresholds=4 FirstExtra=140/0.25 StepWeight=0.2
info: FileWatcherApp.Messaging.RabbitMqConnection[0]
      RabbitMQ conectado em 192.168.10.13:5672 vhost=/
info: FileWatcherApp.Messaging.RpcPingResponderService[0]
      RPC responder ouvindo fila filewatcher.rpc.ping
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [BOOT] FileWatcherService em Debian GNU/Linux 13 (trixie) (X64) Machine='ynz'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [CFG] Pastas monitoradas: Laser='./test_env/Laser' Facas='./test_env/FacasDXF' Dobras='./test_env/Dobras' Ops='./test_env/Ops' Destacador='./test_env/Laser/DESTACADOR'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-LASER] Ativo em './test_env/Laser' (Queue=laser_notifications)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-FACAS] Ativo em './test_env/FacasDXF' (Queue=facas_notifications)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-DOBRAS] Ativo em './test_env/Dobras' (Queue=dobra_notifications)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-OPS] Ativo em './test_env/Ops' (Queue=op.imported)
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Iniciando DXFAnalysisWorker... fila=facas.analysis.request paralelismo=4
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Config imagem: persistLocal=False storageEnabled=True provider=s3 endpoint=http://192.168.10.13:9000 bucket=facas-renders keyPrefix=renders
info: FileWatcherApp.Messaging.FileCommandConsumer[0]
      FileCommandConsumer ouvindo fila file_commands
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Production
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /home/ynz/Documents/FileWatcherApp
[RABBIT-CONSOLE] BodyLen=83 Content={"action":"RENAME_PRIORITY","nr":"514820","newPriority":"AZUL","directory":"LASER"}
info: FileWatcherApp.Messaging.FileCommandConsumer[0]
      [RENAME] NR514820.dxf -> NR514820_AZUL.dxf
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-LASER] MOVE './test_env/Laser/NR514820.dxf' -> './test_env/Laser/NR514820_AZUL.dxf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [PROCESS-LASER] Arquivo DXF 'NR514820_AZUL.dxf' fora do padrão; enviando para análise (queue=laser_notifications)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [DXF] Request publicado opId=NR514820 file='./test_env/Laser/NR514820_AZUL.dxf' resolved='./test_env/Laser/NR514820_AZUL.dxf'
fail: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Falha ao processar análise DXF
      netDxf.IO.DxfVersionNotSupportedException: DXF file version not supported : Unknown.
         at netDxf.IO.DxfReader.Read(Stream stream, SupportFolders supportFolders)
         at netDxf.DxfDocument.Load(String file, IEnumerable`1 supportFolders)
         at netDxf.DxfDocument.Load(String file)
         at FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker.LoadDocumentWithFallback(String path) in /home/ynz/Documents/FileWatcherApp/Services/DXFAnalysis/DXFAnalysisWorker.cs:line 309
         at FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker.<>c__DisplayClass27_0.<ProcessMessageAsync>b__0() in /home/ynz/Documents/FileWatcherApp/Services/DXFAnalysis/DXFAnalysisWorker.cs:line 237
         at System.Threading.Tasks.Task`1.InnerInvoke()
         at System.Threading.ExecutionContext.RunFromThreadPoolDispatchLoop(Thread threadPoolThread, ExecutionContext executionContext, ContextCallback callback, Object state)
      --- End of stack trace from previous location ---
         at System.Threading.ExecutionContext.RunFromThreadPoolDispatchLoop(Thread threadPoolThread, ExecutionContext executionContext, ContextCallback callback, Object state)
         at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
      --- End of stack trace from previous location ---
         at FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker.ProcessMessageAsync(BasicDeliverEventArgs eventArgs) in /home/ynz/Documents/FileWatcherApp/Services/DXFAnalysis/DXFAnalysisWorker.cs:line 237
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Resultado publicado analysisId=d71f6a70-9cab-4d8c-bd06-c0f758b95976 file=NR514820_AZUL.dxf score=(null) duration=38ms
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-FACAS] Created file='NR 120184.dxf' dir='./test_env/FacasDXF' full='./test_env/FacasDXF/NR 120184.dxf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-FACAS] Changed file='NR 120184.dxf' dir='./test_env/FacasDXF' full='./test_env/FacasDXF/NR 120184.dxf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [PROCESS-FACAS] Arquivo DXF 'NR 120184.dxf' fora do padrão; enviando para análise (queue=facas_notifications)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [DXF] Request publicado opId=NR120184 file='./test_env/FacasDXF/NR 120184.dxf' resolved='./test_env/FacasDXF/NR 120184.dxf'
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      DXF ./test_env/FacasDXF/NR 120184.dxf reloaded with header upgrade (AutoCAD 2000 fallback)
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      DXF ./test_env/FacasDXF/NR 120184.dxf reloaded with header upgrade (AutoCAD 2000 fallback)
[SCORER-CONFIG] NumCurvesWeight=0.6 ExtraThresholds=4 Step=(45,0.2,1.2) Dangling=4 MinRadiusDanger=0.35 SerrilhaPresence=0.65 ColaWeight=0.45
info: FileWatcherApp.Services.DXFAnalysis.ComplexityScorer[0]
      [SCORER] Pesos carregados | NumCurvesWeight=0.6 ExtraThresholds=4 Step=(45,0.2,1.2) DanglingThresholds=4 MinRadiusDanger=0.35 SerrilhaPresence=0.65 ColaWeight=0.45
[CURVES] Extra threshold hit: curves=266 >= 140 weight=0.25
[CURVES] Extra threshold hit: curves=266 >= 220 weight=0.35
[CURVES] Step contribution: curves=266 extra=206 steps=4.58 weight=0.92
info: FileWatcherApp.Services.DXFAnalysis.Rendering.CalibratedDxfRenderer[0]
      Render DXF ./test_env/FacasDXF/NR 120184.dxf: Bounding box global utilizado (faca não encontrada): xMin=-26.999, xMax=3194.907, yMin=-35.000, yMax=922.116, largura=3221.906, altura=957.116
info: FileWatcherApp.Services.DXFAnalysis.Rendering.CalibratedDxfRenderer[0]
      Render DXF ./test_env/FacasDXF/NR 120184.dxf: escala=0.620751 px/unid | offset=(26.999, 35.000) | padding≈(0.0%, 0.1%) | área renderizada=(3221.906 x 957.116)
info: FileWatcherApp.Services.DXFAnalysis.Rendering.CalibratedDxfRenderer[0]
      Render DXF ./test_env/FacasDXF/NR 120184.dxf: 3282 primitivas renderizadas (sem filtro).
info: FileWatcherApp.Services.DXFAnalysis.Rendering.CalibratedDxfRenderer[0]
      Renderização concluída para ./test_env/FacasDXF/NR 120184.dxf. Dimensões=2000x595 px | DPI efetivo≈15.77 | faixas combinadas=False | moldura ignorada=False | fallback filtro=False
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Iniciando upload da imagem renderizada (hash=sha256:e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df)
info: FileWatcherApp.Services.DXFAnalysis.Storage.S3ImageStorageClient[0]
      Enviando imagem para facas-renders/renders/sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df/nr_120184.png (tentativa 1/3)
info: FileWatcherApp.Services.DXFAnalysis.Storage.S3ImageStorageClient[0]
      Upload concluído para facas-renders/renders/sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df/nr_120184.png (ETag="fa88684499454dbcbbb2a804f3e8d235")
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Upload concluído: facas-renders/renders/sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df/nr_120184.png (uploaded)
info: FileWatcherApp.Services.DXFAnalysis.DXFAnalysisWorker[0]
      Resultado publicado analysisId=2f872546-74a3-48fb-817c-561c660fd325 file=NR 120184.dxf score=5 duration=631ms
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-FACAS] Created file='sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df.analysis.json' dir='./test_env/FacasDXF/Cache' full='./test_env/FacasDXF/Cache/sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df.analysis.json'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-FACAS] Changed file='sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df.analysis.json' dir='./test_env/FacasDXF/Cache' full='./test_env/FacasDXF/Cache/sha256_e7773a2c833677ca7c7a63e4661045413b06cf301e1c1c637a1d5084ff1f56df.analysis.json'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-OPS] Created file='Ordem de Produção nº 120432.pdf' dir='./test_env/Ops' full='./test_env/Ops/Ordem de Produção nº 120432.pdf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-OPS] Changed file='Ordem de Produção nº 120432.pdf' dir='./test_env/Ops' full='./test_env/Ops/Ordem de Produção nº 120432.pdf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [PROCESS-OPS] OP detectada file='Ordem de Produção nº 120432.pdf' path='./test_env/Ops/Ordem de Produção nº 120432.pdf' queue=op.imported
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [OP] Import publicada: 120432 (emborrachada=False, vaiVinco=True)
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-OPS] Created file='Ordem de Produção nº 120432.pdf' dir='./test_env/Ops' full='./test_env/Ops/Ordem de Produção nº 120432.pdf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [WATCHER-OPS] Changed file='Ordem de Produção nº 120432.pdf' dir='./test_env/Ops' full='./test_env/Ops/Ordem de Produção nº 120432.pdf'
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [PROCESS-OPS] OP detectada file='Ordem de Produção nº 120432.pdf' path='./test_env/Ops/Ordem de Produção nº 120432.pdf' queue=op.imported
info: FileWatcherApp.Services.FileWatcher.FileWatcherService[0]
      [OP] Import publicada: 120432 (emborrachada=False, vaiVinco=True)
